import logging
import random
from datetime import datetime

from telegram import Update, ReplyKeyboardMarkup, ReplyKeyboardRemove
from telegram.ext import (
    Application,
    CommandHandler,
    MessageHandler,
    filters,
    ContextTypes,
    ConversationHandler,
)

# ================== –õ–û–ì–ò–†–û–í–ê–ù–ò–ï ==================
logging.basicConfig(
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    level=logging.INFO,
)
logger = logging.getLogger(__name__)

print("ü§ñ –ó–ê–ü–£–°–ö –£–ú–ù–û–ì–û –ë–û–¢–ê –î–õ–Ø –û–ù–ö–û–ü–ê–¶–ò–ï–ù–¢–û–í...")

# ================== –¢–û–ö–ï–ù –ë–û–¢–ê ==================
TELEGRAM_TOKEN = "8458251576:AAF8OisIb5eeD26DDbtbV1Qic2UAz--mJG0"

# ================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –°–ß–Å–¢–ß–ò–ö–ò ==================
message_count = 0
last_instruction_sent = 0  # –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫

# ================== –°–û–°–¢–û–Ø–ù–ò–Ø –î–ò–ê–õ–û–ì–ê ==================
CHOOSING_TYPE, DESCRIBING_PROBLEM, FILLING_DETAILS, CONFIRMING = range(4)

# ================== –ë–ê–ó–ê –ó–ê–ö–û–ù–û–í –†–§ ==================
LAWS_DATABASE = {
    "–ø—Ä–∞–≤–æ –Ω–∞ –ª–µ—á–µ–Ω–∏–µ": {
        "law": "–°—Ç–∞—Ç—å—è 11 –§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∑–∞–∫–æ–Ω–∞ –æ—Ç 21.11.2011 ‚Ññ 323-–§–ó ¬´–û–± –æ—Å–Ω–æ–≤–∞—Ö –æ—Ö—Ä–∞–Ω—ã –∑–¥–æ—Ä–æ–≤—å—è –≥—Ä–∞–∂–¥–∞–Ω¬ª",
        "text": "–ì—Ä–∞–∂–¥–∞–Ω–µ –∏–º–µ—é—Ç –ø—Ä–∞–≤–æ –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –æ–∫–∞–∑–∞–Ω–∏–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ø–æ–º–æ—â–∏",
    },
    "–æ—Ç–∫–∞–∑ –≤ –ø–æ–º–æ—â–∏": {
        "law": "–°—Ç–∞—Ç—å—è 11 –§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∑–∞–∫–æ–Ω–∞ ‚Ññ 323-–§–ó",
        "text": "–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –ø–æ–º–æ—â—å –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º—ã –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥–∞—Ä–∞–Ω—Ç–∏–π",
    },
    "–ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ": {
        "law": "–°—Ç–∞—Ç—å—è 80 –§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∑–∞–∫–æ–Ω–∞ ‚Ññ 323-–§–ó",
        "text": "–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞–º–∏ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º",
    },
    "–∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å": {
        "law": "–§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –∑–∞–∫–æ–Ω –æ—Ç 24.11.1995 ‚Ññ 181-–§–ó ¬´–û —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞—â–∏—Ç–µ –∏–Ω–≤–∞–ª–∏–¥–æ–≤¬ª",
        "text": "–ì—Ä–∞–∂–¥–∞–Ω–∞–º –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–æ –Ω–∞ –º–µ–¥–∏–∫–æ-—Å–æ—Ü–∏–∞–ª—å–Ω—É—é —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—É",
    },
    "—Å—Ä–æ–∫–∏ –æ–∫–∞–∑–∞–Ω–∏—è –ø–æ–º–æ—â–∏": {
        "law": "–ü—Ä–æ–≥—Ä–∞–º–º–∞ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥–∞—Ä–∞–Ω—Ç–∏–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –æ–∫–∞–∑–∞–Ω–∏—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ø–æ–º–æ—â–∏",
        "text": "–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–µ–¥–µ–ª—å–Ω—ã–µ —Å—Ä–æ–∫–∏ –æ–∂–∏–¥–∞–Ω–∏—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ø–æ–º–æ—â–∏",
    },
    "–∫–∞—á–µ—Å—Ç–≤–æ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ø–æ–º–æ—â–∏": {
        "law": "–°—Ç–∞—Ç—å—è 10 –§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∑–∞–∫–æ–Ω–∞ ‚Ññ 323-–§–ó",
        "text": "–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –ø–æ–º–æ—â—å –¥–æ–ª–∂–Ω–∞ –æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø–æ—Ä—è–¥–∫–∞–º–∏ –æ–∫–∞–∑–∞–Ω–∏—è –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º–∏",
    },
}

# ================== –®–ê–ë–õ–û–ù–´ –ó–ê–Ø–í–õ–ï–ù–ò–ô (–ë–ï–ó –§–ò–û –ò –£–ß–†–ï–ñ–î–ï–ù–ò–Ø) ==================
APPLICATION_TEMPLATES = {
    "–æ—Ç–∫–∞–∑ –≤ –ª–µ—á–µ–Ω–∏–∏": {
        "template": """–ó–ê–Ø–í–õ–ï–ù–ò–ï

–Ø –æ–±—Ä–∞—â–∞–ª—Å—è(–∞—Å—å) –∑–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ø–æ–º–æ—â—å—é –ø–æ –ø–æ–≤–æ–¥—É –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è (—É—Ç–æ—á–Ω–∏—Ç–µ –¥–∏–∞–≥–Ω–æ–∑).

–ö—Ä–∞—Ç–∫–æ —Å—É—Ç—å —Å–∏—Ç—É–∞—Ü–∏–∏:
{details}

–°–æ–≥–ª–∞—Å–Ω–æ {law_refusal} –ø—Ä–æ—à—É:

1. –û–∫–∞–∑–∞—Ç—å –º–µ–¥–∏—Ü–∏–Ω—Å–∫—É—é –ø–æ–º–æ—â—å –≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–º –æ–±—ä—ë–º–µ.
2. –í —Å–ª—É—á–∞–µ –æ—Ç–∫–∞–∑–∞ ‚Äî –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–∏—Å—å–º–µ–Ω–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∑–∞–∫–æ–Ω–æ–º —Å—Ä–æ–∫.
3. –†–∞–∑—ä—è—Å–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –æ–±–∂–∞–ª–æ–≤–∞–Ω–∏—è –æ—Ç–∫–∞–∑–∞.

{date}
{signature}""",
        "fields": ["details"],
        "laws": ["–ø—Ä–∞–≤–æ –Ω–∞ –ª–µ—á–µ–Ω–∏–µ", "–æ—Ç–∫–∞–∑ –≤ –ø–æ–º–æ—â–∏"],
        "law_placeholder": "law_refusal",
    },

    "–ø–æ–ª—É—á–µ–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤": {
        "template": """–ó–ê–Ø–í–õ–ï–ù–ò–ï

–ú–Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è (—É—Ç–æ—á–Ω–∏—Ç–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç –∏ —Å—Ö–µ–º—É –ª–µ—á–µ–Ω–∏—è).

–ö—Ä–∞—Ç–∫–æ —Å—É—Ç—å —Å–∏—Ç—É–∞—Ü–∏–∏:
{details}

–°–æ–≥–ª–∞—Å–Ω–æ {law_medication} –ø–∞—Ü–∏–µ–Ω—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –Ω–∞ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞–º–∏.

–ü–†–û–®–£:

1. –û–±–µ—Å–ø–µ—á–∏—Ç—å –º–µ–Ω—è –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–º –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–º.
2. –í —Å–ª—É—á–∞–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞ ‚Äî —Å–æ–æ–±—â–∏—Ç—å –æ —Å—Ä–æ–∫–∞—Ö –µ–≥–æ –∑–∞–∫—É–ø–∫–∏ –∏ –≤—ã–¥–∞—á–∏.
3. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–∏—Å—å–º–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –æ –ø—Ä–∏–Ω—è—Ç—ã—Ö –º–µ—Ä–∞—Ö.

{date}
{signature}""",
        "fields": ["details"],
        "laws": ["–ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ"],
        "law_placeholder": "law_medication",
    },

    "–º—Å—ç –∏ –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å": {
        "template": """–ó–ê–Ø–í–õ–ï–ù–ò–ï

–Ø –ø—Ä–æ—Ö–æ–∂—É –ª–µ—á–µ–Ω–∏–µ –ø–æ –ø–æ–≤–æ–¥—É –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è (—É—Ç–æ—á–Ω–∏—Ç–µ –¥–∏–∞–≥–Ω–æ–∑) –∏ –∏–º–µ—é –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∂–∏–∑–Ω–µ–¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

–ö—Ä–∞—Ç–∫–æ —Å—É—Ç—å —Å–∏—Ç—É–∞—Ü–∏–∏:
{details}

–°–æ–≥–ª–∞—Å–Ω–æ {law_disability} –≥—Ä–∞–∂–¥–∞–Ω–∏–Ω –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –Ω–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –º–µ–¥–∏–∫–æ-—Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å—Ç–æ–π–∫–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –∂–∏–∑–Ω–µ–¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

–ü–†–û–®–£:

1. –ù–∞–ø—Ä–∞–≤–∏—Ç—å –º–µ–Ω—è –Ω–∞ –º–µ–¥–∏–∫–æ-—Å–æ—Ü–∏–∞–ª—å–Ω—É—é —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—É (–ú–°–≠).
2. –í —Å–ª—É—á–∞–µ –æ—Ç–∫–∞–∑–∞ ‚Äî –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–∏—Å—å–º–µ–Ω–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ.
3. –†–∞–∑—ä—è—Å–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –æ–±–∂–∞–ª–æ–≤–∞–Ω–∏—è –æ—Ç–∫–∞–∑–∞.

{date}
{signature}""",
        "fields": ["details"],
        "laws": ["–∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å"],
        "law_placeholder": "law_disability",
    },
}

# ================== –û–¢–í–ï–¢–´ –ù–ê –ö–õ–Æ–ß–ï–í–´–ï –°–õ–û–í–ê ==================
KEYWORD_RESPONSES = {
    # –ö—É—Ä–∞—Ç–æ—Ä
    "–∫—É—Ä–∞—Ç–æ—Ä": (
        "üë©‚Äçüíº <b>–ö—É—Ä–∞—Ç–æ—Ä —á–∞—Ç–∞ ‚Äî –ù–∞–¥–µ–∂–¥–∞ –í–∞—Å–∏–ª—å–µ–≤–Ω–∞</b>\n\n"
        "‚úÖ –ß—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å, —É–∫–∞–∂–∏—Ç–µ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏:\n"
        "@Nadezhda_maruseeva\n\n"
        "üí° –ë–µ–∑ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è @Nadezhda_maruseeva –æ—Ç–≤–µ—Ç –º–æ–∂–µ—Ç –Ω–µ –ø—Ä–∏–π—Ç–∏."
    ),
    "–Ω–∞–¥–µ–∂–¥–∞": (
        "üë©‚Äçüíº <b>–ù–∞–¥–µ–∂–¥–∞ –í–∞—Å–∏–ª—å–µ–≤–Ω–∞ ‚Äî –∫—É—Ä–∞—Ç–æ—Ä —á–∞—Ç–∞</b>\n\n"
        "‚úÖ –î–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è —É–∫–∞–∂–∏—Ç–µ: @Nadezhda_maruseeva\n\n"
        "üìß Email: anoanastasiya@mail.ru"
    ),

    # –î–æ–∫—É–º–µ–Ω—Ç—ã
    "–¥–æ–∫—É–º–µ–Ω—Ç—ã": (
        "üìã <b>–û–±—Ä–∞–∑—Ü—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:</b>\n\n"
        "üîó https://t.me/c/1790682693/457"
    ),
    "–∑–∞—è–≤–ª–µ–Ω–∏–µ": (
        "üìã <b>–û–±—Ä–∞–∑—Ü—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:</b>\n\n"
        "üîó https://t.me/c/1790682693/457"
    ),

    # –°—Ä–æ–∫–∏
    "—Å—Ä–æ–∫–∏": (
        "‚è∞ <b>–°—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π:</b>\n\n"
        "üîó https://t.me/c/1790682693/6369"
    ),
    "–∫–∞–∫–∏–µ —Å—Ä–æ–∫–∏": (
        "‚è∞ <b>–°—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏–∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö –ø–∞—Ç–æ–ª–æ–≥–æ-–∞–Ω–∞—Ç–æ–º–∏—á–µ—Å–∫–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π:</b>\n\n"
        "üîó https://t.me/c/1790682693/6369"
    ),

    # –ü–ª–∞—Ç–Ω–æ / –±–µ—Å–ø–ª–∞—Ç–Ω–æ
    "–ø–ª–∞—Ç–Ω–æ": (
        "üí≥ <b>–ï—Å–ª–∏ –∑–∞—Å—Ç–∞–≤–∏–ª–∏ –ø–ª–∞—Ç–∏—Ç—å:</b>\n\n"
        "üîó –í–æ–∑–≤—Ä–∞—Ç –¥–µ–Ω–µ–≥: https://t.me/c/1790682693/6650\n"
        "üîó –ü–∞–º—è—Ç–∫–∞ –ú–∏–Ω–∑–¥—Ä–∞–≤–∞: https://t.me/c/1790682693/8960\n"
        "üîó –¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã: https://t.me/c/1790682693/5612"
    ),
    "–±–µ—Å–ø–ª–∞—Ç–Ω–æ": (
        "üí≥ <b>–ì–∞—Ä–∞–Ω—Ç–∏–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –ø–æ–º–æ—â–∏:</b>\n\n"
        "üîó –¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã: https://t.me/c/1790682693/5612\n"
        "üîó –í–æ–∑–≤—Ä–∞—Ç –¥–µ–Ω–µ–≥: https://t.me/c/1790682693/6650\n"
        "üîó –ü–∞–º—è—Ç–∫–∞ –ú–∏–Ω–∑–¥—Ä–∞–≤–∞: https://t.me/c/1790682693/8960"
    ),

    # –ê–¥–º–∏–Ω
    "–∞–¥–º–∏–Ω": (
        "üë®‚Äçüíº <b>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —á–∞—Ç–∞</b>\n\n"
        "üí° –ï—Å–ª–∏ –∞–¥–º–∏–Ω—ã –Ω–µ –æ—Ç–≤–µ—á–∞—é—Ç, –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫–æ –º–Ω–µ.\n\n"
        "üìù –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n"
        "‚Ä¢ –∫—É—Ä–∞—Ç–æ—Ä, –Ω–∞–¥–µ–∂–¥–∞\n"
        "‚Ä¢ –¥–æ–∫—É–º–µ–Ω—Ç—ã, –∑–∞—è–≤–ª–µ–Ω–∏–µ\n"
        "‚Ä¢ —Å—Ä–æ–∫–∏, –∫–∞–∫–∏–µ —Å—Ä–æ–∫–∏\n"
        "‚Ä¢ –ø–ª–∞—Ç–Ω–æ, –±–µ—Å–ø–ª–∞—Ç–Ω–æ\n"
        "‚Ä¢ 057, —Ñ–æ—Ä–º–∞ 057\n"
        "‚Ä¢ –ø–æ–º–æ—â—å, –ø–æ–ª–µ–∑–Ω–æ–µ\n"
        "‚Ä¢ –∫–ª–∏–Ω—Ä–µ–∫–∏, —Ä—É–±—Ä–∏–∫–∞—Ç–æ—Ä\n"
        "‚Ä¢ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫\n"
        "‚Ä¢ –¥–∏—Å–ø–∞–Ω—Å–µ—Ä\n"
        "‚Ä¢ —Ç–µ–ª–µ–º–µ–¥–∏—Ü–∏–Ω–∞\n"
        "‚Ä¢ –º—Å—ç, –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å\n"
        "‚Ä¢ –≥–æ—Å–∑–∞–∫—É–ø–∫–∏\n"
        "‚Ä¢ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞\n"
        "‚Ä¢ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã\n"
        "‚Ä¢ –Ω–∞–ª–æ–≥–æ–≤—ã–π\n"
        "‚Ä¢ –≥–æ—Ä—è—á–∏–µ –ª–∏–Ω–∏–∏"
    ),
    "–∞–¥–º–∏–Ω—ã": (
        "üë®‚Äçüíº <b>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —á–∞—Ç–∞</b>\n\n"
        "üí° –ï—Å–ª–∏ –∞–¥–º–∏–Ω—ã –∑–∞–Ω—è—Ç—ã, –Ω–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ –æ–¥–Ω–æ –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø–æ–º–æ—â–∏."
    ),

    # –§–æ—Ä–º–∞ 057
    "057": (
        "üìã <b>–§–æ—Ä–º–∞ 057/—É-04:</b>\n\n"
        "üîó https://t.me/c/1790682693/444"
    ),
    "—Ñ–æ—Ä–º–∞ 057": (
        "üìã <b>–§–æ—Ä–º–∞ 057/—É-04:</b>\n\n"
        "üîó https://t.me/c/1790682693/444"
    ),

    # –ü–æ–º–æ—â—å
    "–ø–æ–º–æ—â—å": (
        "üÜò <b>–ü–æ–º–æ—â—å –ø–æ –±–æ—Ç—É</b>\n\n"
        "üí° –ù–∞–ø–∏—à–∏—Ç–µ –ª—é–±–æ–µ —Å–ª–æ–≤–æ:\n"
        "‚Ä¢ –∫—É—Ä–∞—Ç–æ—Ä, –Ω–∞–¥–µ–∂–¥–∞\n"
        "‚Ä¢ –¥–æ–∫—É–º–µ–Ω—Ç—ã, –∑–∞—è–≤–ª–µ–Ω–∏–µ\n"
        "‚Ä¢ —Å—Ä–æ–∫–∏, –ø–ª–∞—Ç–Ω–æ\n"
        "‚Ä¢ –∞–¥–º–∏–Ω, 057\n"
        "‚Ä¢ –ø–æ–º–æ—â—å, –ø–æ–ª–µ–∑–Ω–æ–µ\n"
        "‚Ä¢ –∫–ª–∏–Ω—Ä–µ–∫–∏, —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫\n"
        "‚Ä¢ –¥–∏—Å–ø–∞–Ω—Å–µ—Ä\n"
        "‚Ä¢ —Ç–µ–ª–µ–º–µ–¥–∏—Ü–∏–Ω–∞, –º—Å—ç\n"
        "‚Ä¢ –≥–æ—Å–∑–∞–∫—É–ø–∫–∏, –ª–µ–∫–∞—Ä—Å—Ç–≤–∞\n"
        "‚Ä¢ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã, –Ω–∞–ª–æ–≥–æ–≤—ã–π\n"
        "‚Ä¢ –≥–æ—Ä—è—á–∏–µ –ª–∏–Ω–∏–∏\n\n"
        "üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏: https://t.me/c/1790682693/322\n"
        "üîó –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: https://t.me/c/1790682693/6370"
    ),
    "–ø–æ–ª–µ–∑–Ω–æ–µ": (
        "üìö <b>–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:</b>\n\n"
        "üîó –û—Å–Ω–æ–≤–Ω–∞—è –ø–æ–¥–±–æ—Ä–∫–∞: https://t.me/c/1790682693/322\n"
        "üîó –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã: https://t.me/c/1790682693/6370"
    ),

    # –ö–ª–∏–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    "–∫–ª–∏–Ω—Ä–µ–∫–∏": (
        "üìñ <b>–ö–ª–∏–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</b>\n\n"
        "üîó –†—É–±—Ä–∏–∫–∞—Ç–æ—Ä –ú–∏–Ω–∑–¥—Ä–∞–≤–∞: https://cr.minzdrav.gov.ru/\n"
        "üîó –ù–µ–π—Ä–æ—ç–Ω–¥–æ–∫—Ä–∏–Ω–Ω—ã–µ –æ–ø—É—Ö–æ–ª–∏: https://t.me/c/1790682693/595\n"
        "üîó –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ –ú–ö–ë-10: https://cr.minzdrav.gov.ru/rubricator"
    ),
    "—Ä—É–±—Ä–∏–∫–∞—Ç–æ—Ä": (
        "üìñ <b>–†—É–±—Ä–∏–∫–∞—Ç–æ—Ä –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π:</b>\n\n"
        "üîó –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç: https://cr.minzdrav.gov.ru/\n"
        "üîó –ü–æ –ú–ö–ë-10: https://cr.minzdrav.gov.ru/rubricator"
    ),

    # –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫
    "—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫": (
        "üìò <b>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –¥–ª—è –æ–Ω–∫–æ–ø–∞—Ü–∏–µ–Ω—Ç–æ–≤</b>\n\n"
        "¬´–ß—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –æ –≤–∞—à–∏—Ö –ø—Ä–∞–≤–∞—Ö, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö, –ª—å–≥–æ—Ç–∞—Ö¬ª\n\n"
        "üîó https://t.me/c/1790682693/8377"
    ),

    # –î–∏—Å–ø–∞–Ω—Å–µ—Ä
    "–¥–∏—Å–ø–∞–Ω—Å–µ—Ä": (
        "üè• <b>–î–∏—Å–ø–∞–Ω—Å–µ—Ä–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ:</b>\n\n"
        "üîó –û–Ω–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –±–æ–ª—å–Ω—ã—Ö: https://t.me/c/1790682693/4385\n"
        "üîó –ü–æ—Ä—è–¥–æ–∫ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è: https://t.me/c/1790682693/2435"
    ),

    # –¢–µ–ª–µ–º–µ–¥–∏—Ü–∏–Ω–∞
    "—Ç–µ–ª–µ–º–µ–¥–∏—Ü–∏–Ω–∞": (
        "üíª <b>–¢–µ–ª–µ–º–µ–¥–∏—Ü–∏–Ω–∞:</b>\n\n"
        "üîó –í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: https://t.me/c/1790682693/3657"
    ),

    # –ú–°–≠ –∏ –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
    "–º—Å—ç": (
        "‚ôø <b>–ú–µ–¥–∏–∫–æ-—Å–æ—Ü–∏–∞–ª—å–Ω–∞—è —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞:</b>\n\n"
        "üîó –ü–æ–¥–±–æ—Ä–∫–∞ –ø–æ –ú–°–≠: https://t.me/c/1790682693/3534\n"
        "üîó –¢–µ–ª–µ–≥—Ä–∞–º –ú–°–≠: https://t.me/c/1790682693/2788\n"
        "üîó –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏: https://t.me/c/1790682693/5595\n"
        "üîó –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–∞ –ì–æ—Å—É—Å–ª—É–≥–∞—Ö: https://t.me/c/1790682693/8099"
    ),
    "–∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å": (
        "‚ôø <b>–ò–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å:</b>\n\n"
        "üîó –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ: https://onkologiya-site.ru/invalid_i_invalidnost\n"
        "üîó –ù–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫: https://t.me/c/1790682693/747\n"
        "üîó –ï—Å–ª–∏ –æ—Ç–∫–∞–∑–∞–ª–∏: https://t.me/c/1790682693/4335"
    ),

    # –ì–æ—Å–∑–∞–∫—É–ø–∫–∏
    "–≥–æ—Å–∑–∞–∫—É–ø–∫–∏": (
        "üìä <b>–ì–æ—Å–∑–∞–∫—É–ø–∫–∏ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤:</b>\n\n"
        "üîó –°–∞–π—Ç –≥–æ—Å–∑–∞–∫—É–ø–æ–∫: https://zakupki.gov.ru/epz/main/public/home.html"
    ),

    # –õ–µ–∫–∞—Ä—Å—Ç–≤–∞
    "–ª–µ–∫–∞—Ä—Å—Ç–≤–∞": (
        "üíä <b>–õ–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã:</b>\n\n"
        "üîó –û—Ç–ø—É—Å–∫ –ø–æ —Ä–µ—Ü–µ–ø—Ç—É: https://t.me/c/1790682693/656\n"
        "üîó –ü–æ—Ä—è–¥–æ–∫ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: https://t.me/c/1790682693/1418\n"
        "üîó –í—ã–ø–∏—Å–∫–∞ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤: https://t.me/c/1790682693/2227\n"
        "üîó Off-label –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ: https://t.me/c/1790682693/2020"
    ),

    # –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã
    "—Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã": (
        "üìö <b>–°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</b>\n\n"
        "üîó –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –ª–µ—á–µ–Ω–∏—è: http://www.oncology.ru/specialist/treatment/references/\n"
        "üîó –ë–µ–ª–∞—è –∫–Ω–∏–≥–∞ (–¥–∂–µ–Ω–µ—Ä–∏–∫–∏): https://white-medicine.com/\n"
        "üîó –ü—Ä–∏–∫–∞–∑ –ú–∏–Ω–∑–¥—Ä–∞–≤–∞: https://t.me/c/1790682693/2075"
    ),

    # –ù–∞–ª–æ–≥–æ–≤—ã–π –≤—ã—á–µ—Ç
    "–Ω–∞–ª–æ–≥–æ–≤—ã–π": (
        "üí∞ <b>–ù–∞–ª–æ–≥–æ–≤—ã–π –≤—ã—á–µ—Ç:</b>\n\n"
        "üîó –î–ª—è –∏–Ω–≤–∞–ª–∏–¥–æ–≤: https://t.me/c/1790682693/1445"
    ),

    # –ì–æ—Ä—è—á–∏–µ –ª–∏–Ω–∏–∏
    "–≥–æ—Ä—è—á–∏–µ –ª–∏–Ω–∏–∏": (
        "üìû <b>–ì–æ—Ä—è—á–∏–µ –ª–∏–Ω–∏–∏:</b>\n\n"
        "üîó –¢–µ–ª–µ—Ñ–æ–Ω—ã —Å—Ç—Ä–∞—Ö–æ–≤—ã—Ö: https://t.me/c/1790682693/8179\n"
        "üîó –¢–µ–ª–µ—Ñ–æ–Ω—ã –¢–§–û–ú–°: https://t.me/c/1790682693/8179\n"
        "üîó ¬´–û–≥—Ä–æ–º–Ω–æ–µ —Å–µ—Ä–¥—Ü–µ¬ª: 8-800-350-57-85\n"
        "üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏: https://t.me/c/1790682693/8959"
    ),

    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
    "–Ω–∞–≤–∏–≥–∞—Ç–æ—Ä": (
        "üß≠ <b>–ù–∞–≤–∏–≥–∞—Ç–æ—Ä –ø–∞—Ü–∏–µ–Ω—Ç–∞:</b>\n\n"
        "üîó –û—Ç –í—Å–µ—Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ —Å–æ—é–∑–∞ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤: https://t.me/c/1790682693/2487"
    ),
    "–∞–Ω–∫–µ—Ç–∞": (
        "üìù <b>–ê–Ω–∫–µ—Ç–∞ –í–û–ó:</b>\n\n"
        "üîó –ü–æ –ø—Ä–æ–±–ª–µ–º–µ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞: "
        "http://www.rare-diseases.ru/zapolnite-anketu-po-probleme-polucheniya-preparata"
    ),
    "—á–∞—Ç—ã": (
        "üë• <b>–ü–æ–ª–µ–∑–Ω—ã–µ —á–∞—Ç—ã —Ä–µ–≥–∏–æ–Ω–æ–≤:</b>\n\n"
        "üîó –ú–µ–¥—á–∞—Ç—ã —Ä–µ–≥–∏–æ–Ω–æ–≤: https://t.me/c/1790682693/6997\n"
        "üîó –ü–æ–¥–º–æ—Å–∫–æ–≤—å–µ –¢–°–†: https://t.me/c/1790682693/9822\n"
        "üîó –°–æ—Ü—É—Å–ª—É–≥–∏ –ü–æ–¥–º–æ—Å–∫–æ–≤—å—è: https://t.me/c/1790682693/9826"
    ),
}

# ================== –ü–ï–†–ò–û–î–ò–ß–ï–°–ö–ò–ï –ò–ù–°–¢–†–£–ö–¶–ò–ò ==================
INSTRUCTION_MESSAGES = [
    (
        "üìã <b>–ö–ê–ö –ü–û–õ–¨–ó–û–í–ê–¢–¨–°–Ø –ë–û–¢–û–ú?</b>\n\n"
        "–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –æ–¥–Ω–æ –∏–∑ —Å–ª–æ–≤:\n\n"
        "‚Ä¢ <b>–∫—É—Ä–∞—Ç–æ—Ä</b> ‚Äî —Å–≤—è–∑—å —Å –ù–∞–¥–µ–∂–¥–æ–π –í–∞—Å–∏–ª—å–µ–≤–Ω–æ–π\n"
        "‚Ä¢ <b>–¥–æ–∫—É–º–µ–Ω—Ç—ã</b> ‚Äî –æ–±—Ä–∞–∑—Ü—ã –∑–∞—è–≤–ª–µ–Ω–∏–π\n"
        "‚Ä¢ <b>—Å—Ä–æ–∫–∏</b> ‚Äî —Å—Ä–æ–∫–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π\n"
        "‚Ä¢ <b>–ø–ª–∞—Ç–Ω–æ</b> ‚Äî –≤–æ–∑–≤—Ä–∞—Ç –¥–µ–Ω–µ–≥ –∑–∞ –∞–Ω–∞–ª–∏–∑—ã\n"
        "‚Ä¢ <b>–ø–æ–º–æ—â—å</b> ‚Äî —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥\n"
        "‚Ä¢ <b>–ø–æ–ª–µ–∑–Ω–æ–µ</b> ‚Äî –ø–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏\n"
        "‚Ä¢ <b>—Å–æ—Å—Ç–∞–≤—å –∑–∞—è–≤–ª–µ–Ω–∏–µ</b> ‚Äî –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∑–∞—è–≤–ª–µ–Ω–∏–π\n\n"
        "üí° –ü–∏—à–∏—Ç–µ –≤ —á–∞—Ç, —è –æ—Ç–≤–µ—á—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏."
    ),
    (
        "üéØ <b>–ë–û–¢ –ü–û–ú–û–ì–ê–ï–¢ –° –ó–ê–Ø–í–õ–ï–ù–ò–Ø–ú–ò</b>\n\n"
        "–ù–∞–ø–∏—à–∏—Ç–µ <b>¬´—Å–æ—Å—Ç–∞–≤—å –∑–∞—è–≤–ª–µ–Ω–∏–µ¬ª</b>, –∏ —è:\n\n"
        "1. –û–ø—Ä–µ–¥–µ–ª—é —Ç–∏–ø –ø—Ä–æ–±–ª–µ–º—ã.\n"
        "2. –ü–æ–¥–±–µ—Ä—É –∑–∞–∫–æ–Ω—ã –†–§.\n"
        "3. –°–æ—Å—Ç–∞–≤–ª—é —Ç–µ–∫—Å—Ç –∑–∞—è–≤–ª–µ–Ω–∏—è.\n"
        "4. –ü–æ–¥—Å–∫–∞–∂—É, –∫–∞–∫ –∏–º –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è.\n\n"
        "üí° –ü—Ä–∏–º–µ—Ä: <code>—Å–æ—Å—Ç–∞–≤—å –∑–∞—è–≤–ª–µ–Ω–∏–µ ‚Äî –æ—Ç–∫–∞–∑–∞–ª–∏ –≤ –ª–µ—á–µ–Ω–∏–∏</code>"
    ),
    (
        "üîç <b>–ë–´–°–¢–†–´–ô –î–û–°–¢–£–ü –ö –ò–ù–§–û–†–ú–ê–¶–ò–ò</b>\n\n"
        "–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:\n"
        "‚Ä¢ <b>057</b> ‚Äî —Ñ–æ—Ä–º–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n"
        "‚Ä¢ <b>–º—Å—ç</b> ‚Äî –º–µ–¥–∏–∫–æ-—Å–æ—Ü–∏–∞–ª—å–Ω–∞—è —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞\n"
        "‚Ä¢ <b>–ª–µ–∫–∞—Ä—Å—Ç–≤–∞</b> ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤\n"
        "‚Ä¢ <b>–≥–æ—Ä—è—á–∏–µ –ª–∏–Ω–∏–∏</b> ‚Äî —Ç–µ–ª–µ—Ñ–æ–Ω—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏\n"
        "‚Ä¢ <b>—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫</b> ‚Äî –ø—Ä–∞–≤–∞ –æ–Ω–∫–æ–ø–∞—Ü–∏–µ–Ω—Ç–æ–≤\n\n"
        "üí° –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –ª—é–±–æ–µ —Å–ª–æ–≤–æ –∏–∑ —Å–ø–∏—Å–∫–∞."
    ),
    (
        "ü§ñ <b>–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ï –û–¢–í–ï–¢–´</b>\n\n"
        "–Ø –æ—Ç–≤–µ—á–∞—é –Ω–∞:\n"
        "‚Ä¢ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –∫—É—Ä–∞—Ç–æ—Ä—É\n"
        "‚Ä¢ –∑–∞–ø—Ä–æ—Å—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤\n"
        "‚Ä¢ –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Å—Ä–æ–∫–∞–º\n"
        "‚Ä¢ —Å–∏—Ç—É–∞—Ü–∏–∏ —Å –æ–ø–ª–∞—Ç–æ–π\n"
        "‚Ä¢ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–ª–µ–Ω–∏–π\n\n"
        "üí° –ù–µ –Ω—É–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –±–æ—Ç–∞ ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–∏—à–∏—Ç–µ –≤ —á–∞—Ç."
    ),
]

# ================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø ==================
def escape_html(text: str) -> str:
    """–≠–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç —Å–∏–º–≤–æ–ª—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –≤—Å—Ç–∞–≤–∫–∏ –≤ <pre>."""
    return (
        text.replace("&", "&amp;")
        .replace("<", "&lt;")
        .replace(">", "&gt;")
    )

# ================== –ì–õ–û–ë–ê–õ–¨–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï –ó–ê–Ø–í–õ–ï–ù–ò–Ø ==================
current_application: dict = {}

# ================== –ö–û–ù–°–¢–†–£–ö–¢–û–† –ó–ê–Ø–í–õ–ï–ù–ò–ô ==================
async def start_application(update: Update, context: ContextTypes.DEFAULT_TYPE):
    keyboard = [
        ["üìù –û—Ç–∫–∞–∑ –≤ –ª–µ—á–µ–Ω–∏–∏", "üíä –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤"],
        ["‚ôø –ú–°–≠ –∏ –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å", "‚ùå –û—Ç–º–µ–Ω–∞"],
    ]
    reply_markup = ReplyKeyboardMarkup(
        keyboard, one_time_keyboard=True, resize_keyboard=True
    )

    text = (
        "üìù <b>–ö–û–ù–°–¢–†–£–ö–¢–û–† –ó–ê–Ø–í–õ–ï–ù–ò–ô</b>\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–∞—è–≤–ª–µ–Ω–∏—è –∏–ª–∏ –æ–ø–∏—à–∏—Ç–µ —Å–≤–æ—é –ø—Ä–æ–±–ª–µ–º—É.\n\n"
        "‚Ä¢ üìù <b>–û—Ç–∫–∞–∑ –≤ –ª–µ—á–µ–Ω–∏–∏</b>\n"
        "‚Ä¢ üíä <b>–ü–æ–ª—É—á–µ–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤</b>\n"
        "‚Ä¢ ‚ôø <b>–ú–°–≠ –∏ –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å</b>\n\n"
        "–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ—Å—Ç–æ —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ –æ–ø–∏—à–∏—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é: –≥–¥–µ –ª–µ—á–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ, "
        "–∫–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –æ—Ç –≤–∞—Å –∂–¥—É—Ç."
    )

    await update.message.reply_text(text, reply_markup=reply_markup, parse_mode="HTML")
    return CHOOSING_TYPE


async def choose_application_type(update: Update, context: ContextTypes.DEFAULT_TYPE):
    global current_application
    user_choice = update.message.text

    if user_choice == "‚ùå –û—Ç–º–µ–Ω–∞":
        current_application = {}
        await update.message.reply_text(
            "–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–ª–µ–Ω–∏—è –æ—Ç–º–µ–Ω–µ–Ω–æ.", reply_markup=ReplyKeyboardRemove()
        )
        return ConversationHandler.END

    app_type_mapping = {
        "üìù –û—Ç–∫–∞–∑ –≤ –ª–µ—á–µ–Ω–∏–∏": "–æ—Ç–∫–∞–∑ –≤ –ª–µ—á–µ–Ω–∏–∏",
        "üíä –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤": "–ø–æ–ª—É—á–µ–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤",
        "‚ôø –ú–°–≠ –∏ –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å": "–º—Å—ç –∏ –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å",
    }

    if user_choice in app_type_mapping:
        current_application["type"] = app_type_mapping[user_choice]

        text = (
            "–•–æ—Ä–æ—à–æ, —Å–æ—Å—Ç–∞–≤–ª—è–µ–º –∑–∞—è–≤–ª–µ–Ω–∏–µ –ø–æ —Ç–µ–º–µ:\n"
            f"<b>{user_choice}</b>.\n\n"
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–ø–∏—à–∏—Ç–µ –≤–∞—à—É —Å–∏—Ç—É–∞—Ü–∏—é:\n"
            "‚Äî –≥–¥–µ –≤—ã –Ω–∞–±–ª—é–¥–∞–µ—Ç–µ—Å—å;\n"
            "‚Äî –≤ —á—ë–º –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ (–æ—Ç–∫–∞–∑, –∑–∞–¥–µ—Ä–∂–∫–∞, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞ –∏ —Ç.–ø.);\n"
            "‚Äî –∫–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –≤—ã –æ–∂–∏–¥–∞–µ—Ç–µ.\n\n"
            "–Ø –ø–æ–¥—Å—Ç–∞–≤–ª—é —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ —Ç–µ–∫—Å—Ç –∑–∞—è–≤–ª–µ–Ω–∏—è."
        )

        await update.message.reply_text(
            text, reply_markup=ReplyKeyboardRemove(), parse_mode="HTML"
        )
        return DESCRIBING_PROBLEM

    # –ï—Å–ª–∏ –≤–º–µ—Å—Ç–æ –∫–Ω–æ–ø–∫–∏ —Å—Ä–∞–∑—É –Ω–∞—á–∞–ª–∏ –æ–ø–∏—Å—ã–≤–∞—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é
    await analyze_problem_and_suggest(update, context, user_choice)
    return DESCRIBING_PROBLEM


async def analyze_problem_and_suggest(update: Update, context: ContextTypes.DEFAULT_TYPE, user_text: str):
    global current_application

    lower = user_text.lower()

    if any(word in lower for word in ["–æ—Ç–∫–∞–∑", "–Ω–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç", "–æ—Ç–∫–∞–∑—ã–≤–∞—é—Ç", "–Ω–µ –ª–µ—á–∞—Ç"]):
        app_type = "–æ—Ç–∫–∞–∑ –≤ –ª–µ—á–µ–Ω–∏–∏"
        title = "üìù –û—Ç–∫–∞–∑ –≤ –ª–µ—á–µ–Ω–∏–∏"
        suggestion = "–ü–æ—Ö–æ–∂–µ, —Ä–µ—á—å –æ–± –æ—Ç–∫–∞–∑–µ –≤ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ø–æ–º–æ—â–∏. –°–æ—Å—Ç–∞–≤–∏–º –∑–∞—è–≤–ª–µ–Ω–∏–µ –æ–± –æ—Ç–∫–∞–∑–µ –≤ –ª–µ—á–µ–Ω–∏–∏."
    elif any(word in lower for word in ["–ª–µ–∫–∞—Ä—Å—Ç–≤", "–ø—Ä–µ–ø–∞—Ä–∞—Ç", "—Ç–∞–±–ª–µ—Ç–∫", "—É–∫–æ–ª", "–ª–µ–∫–∞—Ä—Å—Ç–≤–æ"]):
        app_type = "–ø–æ–ª—É—á–µ–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤"
        title = "üíä –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤"
        suggestion = "–í–∏–∂—É –ø—Ä–æ–±–ª–µ–º—É —Å –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–º –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ–º. –ü–æ–º–æ–≥—É –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞—è–≤–ª–µ–Ω–∏–µ –æ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤."
    elif any(word in lower for word in ["–º—Å—ç", "–∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å", "–∏–Ω–≤–∞–ª–∏–¥", "—ç–∫—Å–ø–µ—Ä—Ç–∏–∑"]):
        app_type = "–º—Å—ç –∏ –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å"
        title = "‚ôø –ú–°–≠ –∏ –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å"
        suggestion = "–ü–æ—Ö–æ–∂–µ, –≤–æ–ø—Ä–æ—Å –ø–æ –ú–°–≠ –∏–ª–∏ –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏. –°–æ—Å—Ç–∞–≤–∏–º –∑–∞—è–≤–ª–µ–Ω–∏–µ –ø–æ —ç—Ç–æ–π —Ç–µ–º–µ."
    else:
        app_type = "–æ—Ç–∫–∞–∑ –≤ –ª–µ—á–µ–Ω–∏–∏"
        title = "üìù –û—Ç–∫–∞–∑ –≤ –ª–µ—á–µ–Ω–∏–∏"
        suggestion = (
            "–Ø –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é –∑–∞—è–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è. "
            "–ü–æ —Å–º—ã—Å–ª—É —ç—Ç–æ –±–ª–∏–∂–µ –≤—Å–µ–≥–æ –∫ –æ—Ç–∫–∞–∑—É –≤ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ø–æ–º–æ—â–∏."
        )

    current_application["type"] = app_type

    text = (
        f"{suggestion}\n\n"
        "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–ø–∏—à–∏—Ç–µ –≤–∞—à—É —Å–∏—Ç—É–∞—Ü–∏—é:\n"
        "‚Äî –≥–¥–µ –≤—ã –Ω–∞–±–ª—é–¥–∞–µ—Ç–µ—Å—å;\n"
        "‚Äî —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ (–æ—Ç–∫–∞–∑, –∑–∞–¥–µ—Ä–∂–∫–∞, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞ –∏ —Ç.–ø.);\n"
        "‚Äî –∫–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –≤—ã –æ–∂–∏–¥–∞–µ—Ç–µ.\n\n"
        "–Ø –≤—Å—Ç–∞–≤–ª—é —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ —Ç–µ–∫—Å—Ç –∑–∞—è–≤–ª–µ–Ω–∏—è."
    )

    await update.message.reply_text(text, parse_mode="HTML")


async def process_problem_description(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–∏—Å–∞–ª —Å–∏—Ç—É–∞—Ü–∏—é ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∑–∞—è–≤–ª–µ–Ω–∏–µ."""
    global current_application

    user_text = (update.message.text or "").strip()
    if not user_text:
        await update.message.reply_text(
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é —Å–ª–æ–≤–∞–º–∏ ‚Äî —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –∏ —á–µ–≥–æ –≤—ã –¥–æ–±–∏–≤–∞–µ—Ç–µ—Å—å.",
            parse_mode="HTML",
        )
        return DESCRIBING_PROBLEM

    current_application["details"] = user_text
    return await generate_application(update, context)


async def generate_application(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –∑–∞—è–≤–ª–µ–Ω–∏—è."""
    global current_application

    app_type = current_application.get("type", "–æ—Ç–∫–∞–∑ –≤ –ª–µ—á–µ–Ω–∏–∏")
    template = APPLICATION_TEMPLATES[app_type]

    # –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–ª–µ–π
    current_application.setdefault("details", "[–æ–ø–∏—à–∏—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é –ø–æ–¥—Ä–æ–±–Ω–µ–µ]")
    current_application.setdefault("date", datetime.now().strftime("%d.%m.%Y"))
    current_application.setdefault("signature", "________________/__________________")

    # –ó–∞–∫–æ–Ω—ã
    law_names = "; ".join(LAWS_DATABASE[key]["law"] for key in template["laws"])
    law_placeholder = template["law_placeholder"]
    current_application[law_placeholder] = law_names

    application_text = template["template"].format(**current_application)

    # –Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ (–¥—É–±–ª–∏—Ä—É–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–º –±–ª–æ–∫–æ–º)
    legal_basis = "\n\n–Æ–†–ò–î–ò–ß–ï–°–ö–û–ï –û–ë–û–°–ù–û–í–ê–ù–ò–ï:\n"
    for law_key in template["laws"]:
        law = LAWS_DATABASE[law_key]
        legal_basis += f"‚Ä¢ {law['law']} ‚Äî {law['text']}\n"

    full_text = application_text + legal_basis
    safe_text = escape_html(full_text)

    html = (
        "<b>‚úÖ –í–ê–®–ï –ó–ê–Ø–í–õ–ï–ù–ò–ï –ì–û–¢–û–í–û!</b>\n\n"
        f"<pre>{safe_text}</pre>\n\n"
        "<b>–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</b>\n"
        "1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–¥—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø–æ–¥ –≤–∞—à—É —Å–∏—Ç—É–∞—Ü–∏—é.\n"
        "2. –î–æ–±–∞–≤—å—Ç–µ —à–∞–ø–∫—É —Å –∞–¥—Ä–µ—Å–∞—Ç–æ–º –∏ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–§–ò–û, –∞–¥—Ä–µ—Å, –∫–æ–Ω—Ç–∞–∫—Ç—ã).\n"
        "3. –†–∞—Å–ø–µ—á–∞—Ç–∞–π—Ç–µ –∏ –ø–æ–¥–∞–π—Ç–µ –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é.\n"
        "4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–æ–ø–∏—é —Å –æ—Ç–º–µ—Ç–∫–æ–π –æ –ø—Ä–∏—ë–º–µ.\n\n"
        "–ù—É–∂–Ω–æ –¥—Ä—É–≥–æ–µ –∑–∞—è–≤–ª–µ–Ω–∏–µ? –ù–∞–ø–∏—à–∏—Ç–µ <code>—Å–æ—Å—Ç–∞–≤—å –∑–∞—è–≤–ª–µ–Ω–∏–µ</code>."
    )

    await update.message.reply_text(html, parse_mode="HTML")

    current_application = {}
    return ConversationHandler.END


async def cancel_application(update: Update, context: ContextTypes.DEFAULT_TYPE):
    global current_application
    current_application = {}
    await update.message.reply_text(
        "–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–ª–µ–Ω–∏—è –æ—Ç–º–µ–Ω–µ–Ω–æ.", reply_markup=ReplyKeyboardRemove()
    )
    return ConversationHandler.END

# ================== –ë–ê–ó–û–í–´–ï –ö–û–ú–ê–ù–î–´ ==================
async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = (
        "ü§ñ <b>–ü—Ä–∞–≤–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –æ–Ω–∫–æ–ø–∞—Ü–∏–µ–Ω—Ç–æ–≤</b>\n\n"
        "üéØ –Ø –ø–æ–º–æ–≥—É –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.\n\n"
        "<b>–ö—É—Ä–∞—Ç–æ—Ä –∏ –∞–¥–º–∏–Ω—ã:</b>\n"
        "‚Ä¢ –∫—É—Ä–∞—Ç–æ—Ä, –Ω–∞–¥–µ–∂–¥–∞\n"
        "‚Ä¢ –∞–¥–º–∏–Ω, –∞–¥–º–∏–Ω—ã\n\n"
        "<b>–î–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Ñ–æ—Ä–º—ã:</b>\n"
        "‚Ä¢ –¥–æ–∫—É–º–µ–Ω—Ç—ã, –∑–∞—è–≤–ª–µ–Ω–∏–µ\n"
        "‚Ä¢ 057, —Ñ–æ—Ä–º–∞ 057\n\n"
        "<b>–°—Ä–æ–∫–∏ –∏ –æ–ø–ª–∞—Ç–∞:</b>\n"
        "‚Ä¢ —Å—Ä–æ–∫–∏, –∫–∞–∫–∏–µ —Å—Ä–æ–∫–∏\n"
        "‚Ä¢ –ø–ª–∞—Ç–Ω–æ, –±–µ—Å–ø–ª–∞—Ç–Ω–æ\n\n"
        "<b>–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –ø–æ–º–æ—â—å:</b>\n"
        "‚Ä¢ –¥–∏—Å–ø–∞–Ω—Å–µ—Ä\n"
        "‚Ä¢ —Ç–µ–ª–µ–º–µ–¥–∏—Ü–∏–Ω–∞, –º—Å—ç, –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å\n"
        "‚Ä¢ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞, —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã\n\n"
        "<b>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏:</b>\n"
        "‚Ä¢ –∫–ª–∏–Ω—Ä–µ–∫–∏, —Ä—É–±—Ä–∏–∫–∞—Ç–æ—Ä\n"
        "‚Ä¢ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫, –ø–æ–ª–µ–∑–Ω–æ–µ\n"
        "‚Ä¢ –≥–æ—Å–∑–∞–∫—É–ø–∫–∏\n\n"
        "<b>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</b>\n"
        "‚Ä¢ –≥–æ—Ä—è—á–∏–µ –ª–∏–Ω–∏–∏\n"
        "‚Ä¢ —á–∞—Ç—ã —Ä–µ–≥–∏–æ–Ω–æ–≤\n\n"
        "<b>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∑–∞—è–≤–ª–µ–Ω–∏–π:</b>\n"
        "–ù–∞–ø–∏—à–∏—Ç–µ: <code>—Å–æ—Å—Ç–∞–≤—å –∑–∞—è–≤–ª–µ–Ω–∏–µ</code> –∏–ª–∏ <code>–ø–æ–º–æ–≥–∏ —Å –∑–∞—è–≤–ª–µ–Ω–∏–µ–º</code>."
    )
    await update.message.reply_text(text, parse_mode="HTML")


async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = (
        "üÜò <b>–ü–æ–º–æ—â—å –ø–æ –±–æ—Ç—É</b>\n\n"
        "<b>–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:</b>\n"
        "–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ —á–∞—Ç –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –∏–∑ —Å–ø–∏—Å–∫–∞.\n\n"
        "<b>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∑–∞—è–≤–ª–µ–Ω–∏–π:</b>\n"
        "–ù–∞–ø–∏—à–∏—Ç–µ <code>—Å–æ—Å—Ç–∞–≤—å –∑–∞—è–≤–ª–µ–Ω–∏–µ</code> –∏:\n"
        "1. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–∏—Ç—É–∞—Ü–∏–∏.\n"
        "2. –û–ø–∏—à–∏—Ç–µ —Å–≤–æ—é –ø—Ä–æ–±–ª–µ–º—É.\n"
        "3. –ü–æ–ª—É—á–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞—è–≤–ª–µ–Ω–∏—è —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –∑–∞–∫–æ–Ω—ã.\n\n"
        "<b>–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:</b>\n"
        "‚Ä¢ <code>—Å–æ—Å—Ç–∞–≤—å –∑–∞—è–≤–ª–µ–Ω–∏–µ ‚Äî –æ—Ç–∫–∞–∑–∞–ª–∏ –≤ –æ–ø–µ—Ä–∞—Ü–∏–∏</code>\n"
        "‚Ä¢ <code>–ø–æ–º–æ–≥–∏ —Å –∑–∞—è–≤–ª–µ–Ω–∏–µ–º –Ω–∞ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞</code>\n"
        "‚Ä¢ <code>–Ω—É–∂–Ω–æ –∑–∞—è–≤–ª–µ–Ω–∏–µ –Ω–∞ –ú–°–≠</code>"
    )
    await update.message.reply_text(text, parse_mode="HTML")

# ================== –ü–û–ò–°–ö –û–¢–í–ï–¢–û–í –ü–û –ö–õ–Æ–ß–ï–í–´–ú –°–õ–û–í–ê–ú ==================
def find_response(text: str | None):
    if not text:
        return None

    lower = text.lower()

    if any(
        phrase in lower
        for phrase in [
            "—Å–æ—Å—Ç–∞–≤—å –∑–∞—è–≤–ª–µ–Ω–∏–µ",
            "–æ–±—Ä–∞–∑–µ—Ü –∑–∞—è–≤–ª–µ–Ω–∏—è",
            "—à–∞–±–ª–æ–Ω –∑–∞—è–≤–ª–µ–Ω–∏—è",
            "–ø–æ–º–æ–≥–∏ —Å –∑–∞—è–≤–ª–µ–Ω–∏–µ–º",
        ]
    ):
        return None

    for keyword, response in KEYWORD_RESPONSES.items():
        if keyword in lower:
            return response

    return None

# ================== –û–ë–†–ê–ë–û–¢–ß–ò–ö –í–°–ï–• –ü–†–û–ß–ò–• –°–û–û–ë–©–ï–ù–ò–ô ==================
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    global message_count, last_instruction_sent

    if update.message.from_user.is_bot:
        return

    user_text = update.message.text or ""
    user_name = update.message.from_user.first_name
    print(f"üí¨ [{user_name}]: {user_text}")

    message_count += 1

    # –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏
    if message_count - last_instruction_sent >= random.randint(15, 18):
        instruction = random.choice(INSTRUCTION_MESSAGES)
        await update.message.reply_text(instruction, parse_mode="HTML")
        last_instruction_sent = message_count
        print("üí° –û–¢–ü–†–ê–í–õ–ï–ù–ê –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú")

    response = find_response(user_text)

    if response:
        await update.message.reply_text(
            response, parse_mode="HTML", disable_web_page_preview=True
        )
        print("‚úÖ –û–¢–í–ï–¢ –û–¢–ü–†–ê–í–õ–ï–ù")
    else:
        print("ü§´ –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã ‚Äî –±–æ—Ç –º–æ–ª—á–∏—Ç")

# ================== –û–ë–†–ê–ë–û–¢–ß–ò–ö –û–®–ò–ë–û–ö ==================
async def error_handler(update: object, context: ContextTypes.DEFAULT_TYPE):
    logger.error("ü§´ –û–®–ò–ë–ö–ê (–Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é): %s", context.error)

# ================== –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ==================
def main():
    print("=" * 60)
    print("ü§ñ –£–ú–ù–´–ô –ë–û–¢ –î–õ–Ø –û–ù–ö–û–ü–ê–¶–ò–ï–ù–¢–û–í –ó–ê–ü–£–©–ï–ù!")
    print("üéØ 30+ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤")
    print("üìù –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∑–∞—è–≤–ª–µ–Ω–∏–π –±–µ–∑ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –§–ò–û –∏ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è")
    print("üí° –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∫–∞–∂–¥—ã–µ 15‚Äì18 —Å–æ–æ–±—â–µ–Ω–∏–π")
    print("‚öñÔ∏è –ë–∞–∑–∞ –∫–ª—é—á–µ–≤—ã—Ö –∑–∞–∫–æ–Ω–æ–≤ –≤ —Å—Ñ–µ—Ä–µ –∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è")
    print("=" * 60)

    app = Application.builder().token(TELEGRAM_TOKEN).build()

    # –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∑–∞—è–≤–ª–µ–Ω–∏–π
    application_conv_handler = ConversationHandler(
        entry_points=[
            MessageHandler(
                filters.TEXT & ~filters.COMMAND
                & filters.Regex(
                    r"(?i)(—Å–æ—Å—Ç–∞–≤—å –∑–∞—è–≤–ª–µ–Ω–∏–µ|–ø–æ–º–æ–≥–∏ —Å –∑–∞—è–≤–ª–µ–Ω–∏–µ–º|—à–∞–±–ª–æ–Ω –∑–∞—è–≤–ª–µ–Ω–∏—è|–æ–±—Ä–∞–∑–µ—Ü –∑–∞—è–≤–ª–µ–Ω–∏—è)"
                ),
                start_application,
            )
        ],
        states={
            CHOOSING_TYPE: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, choose_application_type)
            ],
            DESCRIBING_PROBLEM: [
                MessageHandler(filters.TEXT & ~filters.COMMAND, process_problem_description)
            ],
        },
        fallbacks=[
            CommandHandler("cancel", cancel_application),
            MessageHandler(filters.Regex(r"(?i)^–æ—Ç–º–µ–Ω–∞$"), cancel_application),
        ],
        allow_reentry=True,
    )

    # –ö–æ–º–∞–Ω–¥—ã
    app.add_handler(CommandHandler("start", start_command))
    app.add_handler(CommandHandler("help", help_command))

    # –°–Ω–∞—á–∞–ª–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∑–∞—è–≤–ª–µ–Ω–∏–π, –∑–∞—Ç–µ–º –æ–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    app.add_handler(application_conv_handler)
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))

    app.add_error_handler(error_handler)

    app.run_polling()


if __name__ == "__main__":
    main()
